---
title: "gams_sex_separated"
output:
  html_document:
    number_sections: yes
    toc: yes
---

## Male and female separated Gams 


Loading the mgcv library

```{r,message = FALSE}
library(mgcv)
```
Loading the database and creating separated datasets for male and female chamois respectively
```{r}

load("db.RData")
male_db<-subset(db,sex ==  2)
female_db<-subset(db,sex == 1)

```
Building different gams based on gam "c5" with a set of variables which had been found as being best explaining the horngrowth by using a wide range of explaining variables.

Randomforest had revealed weight, julianday, elevation (q_media), ndvi summer, ndvi may and percentage of open area as relevant factors. Ndvi may, ndvi summer, elevation and percentage of open area are not included in the model so far. Different models which include one of the additional environmental variables could reveal by AIC analysis different importance of the variables for the different sexes.

### NDVI models

Different principal component analysis vectors had been build for vegetation indices (ndvi):

- may year 1 and may year2
- summer year 1 and summer year 2
- may year 1 and summer year 1
- may year 2 and summer year 2

see data handling.

#### NDVI PCA May year 1 and May year 2

Testing for correlation of model variables in the male and female subsets.

```{r,message = FALSE, warning=FALSE}
library(Hmisc)
attach(female_db)
attach(male_db)
```

```{r}

vFx1 <- as.formula(horn ~

                       Jday +
                       f.substrate +
                       year +
                       council_cod +
                       weight +
                       density +
                       log.ndvi.slop1 +
                       log.ndvi.slop2 +
                       ndvi.maxincr1 +
                       ndvi.maxincr2 +
                       ndvi.m1m2.pc1 +
                       ndvi.m1m2.pc2 + 
                       snow_winter1 +
                       snow_winter2 +
                       r_newsummer1 +
                       r_newsummer2 +
                       twinter.mean1 +
                       twinter.mean2 +
                       tspring1.mean +
                       tspring2.mean +
                       tsummer1.mean +
                       tsummer2.mean +
                       tautumn.mean)
par(mfrow=c(1,1))
plot(varclus(vFx1, data=female_db))
abline(h=0.5,col="red")


vMx1 <- as.formula(horn ~
                     
                     Jday +
                     f.substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     ndvi.m1m2.pc1 +
                     ndvi.m1m2.pc2 + 
                     snow_winter1 +
                     snow_winter2 +
                     r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     tsummer1.mean +
                     tsummer2.mean +
                     tautumn.mean)

plot(varclus(vMx1, data=male_db))
abline(h=0.5,col="red")

```

t_summer1.mean and snow winter2 are correlated in male and female.
r_newsummer1 and tautum.mean are correlated in male and female.
Correlating variables will be excuded and seperated models will be tested with replaced variables 

- t_summer1.mean or snow winter2
- r_new summer1 or tautumn.mean

Loading models.
load
```{r,message =FALSE}
load(file="sex_sep_models.Rdata")
```

Model omitting snow-winter2 and r_newsummer1 

Male model:

```{r,eval=FALSE}
  M_x1.1 <-  gam(horn ~
                 
                 s(density,k=3, bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(Jday,bs="ts") + 
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1m2.pc1,k=4, bs="ts") +
                 s(ndvi.m1m2.pc2,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=male_db, REML=F)

)



```
```{r}
AIC(M_x1.1)
```


Female model:
```{r,eval=FALSE}
F_x1.1 <-  gam(horn ~
                 s(density,k=3, bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(Jday,bs="ts") + 
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1m2.pc1,k=4, bs="ts") +
                 s(ndvi.m1m2.pc2,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=female_db, REML=F)




```

```{r}
AIC(F_x1.1)
```
Checking model

```{r}
gam.check(F_x1.1)

```
Rename for plotting routine and plot effects
```{r}
MOD_F<-(F_x1.1)
MOD_M<-(M_x1.1)

par(mfrow=c(1,2))

plot(MOD_F,main="female",all=T,select=1)
plot(MOD_M,main="male",all=T,select=1)

plot(MOD_F,main="female",all=T,select=2)
plot(MOD_M,main="male",all=T,select=2)

plot(MOD_F,main="female",all=T,select=3)
plot(MOD_M,main="male",all=T,select=3)

plot(MOD_F,main="female",all=T,select=4)
plot(MOD_M,main="male",all=T,select=4)

plot(MOD_F,main="female",all=T,select=5)
plot(MOD_M,main="male",all=T,select=5)

plot(MOD_F,main="female",all=T,select=6)
plot(MOD_M,main="male",all=T,select=6)

plot(MOD_F,main="female",all=T,select=7)
plot(MOD_M,main="male",all=T,select=7)

plot(MOD_F,main="female",all=T,select=8)
plot(MOD_M,main="male",all=T,select=8)

plot(MOD_F,main="female",all=T,select=9)
plot(MOD_M,main="male",all=T,select=9)

plot(MOD_F,main="female",all=T,select=10)
plot(MOD_M,main="male",all=T,select=10)

plot(MOD_F,main="female",all=T,select=11)
plot(MOD_M,main="male",all=T,select=11)

plot(MOD_F,main="female",all=T,select=12)
plot(MOD_M,main="male",all=T,select=12)

plot(MOD_F,main="female",all=T,select=13)
plot(MOD_M,main="male",all=T,select=13)

plot(MOD_F,main="female",all=T,select=14)
plot(MOD_M,main="male",all=T,select=14)

plot(MOD_F,main="female",all=T,select=15)
plot(MOD_M,main="male",all=T,select=15)

plot(MOD_F,main="female",all=T,select=16)
plot(MOD_M,main="male",all=T,select=16)

plot(MOD_F,main="female",all=T,select=17)
plot(MOD_M,main="male",all=T,select=17)

plot(MOD_F,main="female",all=T,select=18)
plot(MOD_M,main="male",all=T,select=18)

plot(MOD_F,main="female",all=T,select=19)
plot(MOD_M,main="male",all=T,select=19)

plot(MOD_F,main="female",all=T,select=20)
plot(MOD_M,main="male",all=T,select=20)

plot(MOD_F,main="female",all=T,select=21)
plot(MOD_M,main="male",all=T,select=21)
```

The same procedure ommitting different combinations of the collinear climate variables.
```{r,eval=FALSE}

M_x1.2 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1m2.pc1,k=4, bs="ts") +
                 s(ndvi.m1m2.pc2,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
                 #s(tautumn.mean, k=3, bs="ts"),
               ,data=male_db, REML=F)

AIC(M_x1.2)# 11923.48

F_x1.2 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1m2.pc1,k=4, bs="ts") +
                 s(ndvi.m1m2.pc2,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
                 #s(tautumn.mean, k=3, bs="ts")
               ,data=female_db, REML=F)



AIC(F_x1.2)# 9922.036

#omitting  tsummer1.mean and r_newsummer1

M_x1.3 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1m2.pc1,k=4, bs="ts") +
                 s(ndvi.m1m2.pc2,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=male_db, REML=F)

AIC(M_x1.3)# 11926.67

F_x1.3 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1m2.pc1,k=4, bs="ts") +
                 s(ndvi.m1m2.pc2,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=female_db, REML=F)



AIC(F_x1.3)# 9923.202

#############
#omitting  tsummer1.mean and tautumn.mean

M_x1.4 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1m2.pc1,k=4, bs="ts") +
                 s(ndvi.m1m2.pc2, k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
                 #s(tautumn.mean, k=3, bs="ts")
               ,data=male_db, REML=F)

AIC(M_x1.4)#  11926.67

F_x1.4 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1m2.pc1,k=4, bs="ts") +
                 s(ndvi.m1m2.pc2,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
                 #s(tautumn.mean, k=3, bs="ts")
               ,data=female_db, REML=F)



AIC(F_x1.4)# 9921.959


```

An overview of the AIC´s will be presented in a table furter below.

#### NDVI PCA Summer 1 and summer 2

Check for collinearity
```{r}
vMx2 <- as.formula(horn ~
                     
                     Jday +
                     substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     ndvi.s1s2.pc1 + 
                     snow_winter1 +
                     snow_winter2 +
                     r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     tsummer1.mean +
                     tsummer2.mean +
                     tautumn.mean)

plot(varclus(vMx2, data=male_db))
abline(h=0.5,col="red")

vFx2 <- as.formula(horn ~
                     
                     Jday +
                     substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     ndvi.s1s2.pc1 + 
                     snow_winter1 +
                     snow_winter2 +
                     r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     tsummer1.mean +
                     tsummer2.mean +
                     tautumn.mean)

plot(varclus(vFx2, data=female_db))
abline(h=0.5,col="red")

```

Corelations are the same as in the previous models.

 - t_summer1.mean und snow winter2 correlated in male and female
 - r_newsummer1 and tautum.mean correlated in male and female
 
The same procedure as with NDVI May1 and May2. 4 models for male and 4 models for female ommitting different combinations of collinear climate variables.

```{r,eval=FALSE}

M_x2.1 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.s1s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=male_db, REML=F)

AIC(M_x2.1)# 11925.25

F_x2.1 <-  gam(horn ~
                 s(Jday,bs="ts")+
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.s1s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=female_db, REML=F)



AIC(F_x2.1)# 9923.85
#model omitting snow winter and tautumn.mean

M_x2.2 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.s1s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
                 #s(tautumn.mean, k=3, bs="ts")
               ,data=male_db, REML=F)

AIC(M_x2.2)#  11925.9

F_x2.2 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=2, bs="ts") +
                 s(ndvi.s1s2.pc1,k=2, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=female_db, REML=F)



AIC(F_x2.2)# 9922.789

#omitting  tsummer1.mean and r_newsummer1

M_x2.3 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.s1s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=male_db, REML=F)

AIC(M_x2.3)# 11927.6

F_x2.3 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.s1s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=female_db, REML=F)



AIC(F_x2.3)# 9925.405

#############
#omitting  tsummer1.mean and tautumn.mean

M_x2.4 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.s1s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=male_db, REML=F)

AIC(M_x2.4)# 11927.6

F_x2.4 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.s1s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=female_db, REML=F)



AIC(F_x2.4)# 9925.488
```


#### NDVI PCA May and summer of the first year

Check for collinearity

```{r}
vMx3 <- as.formula(horn ~
                     
                     Jday +
                     substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     ndvi.m1s1.pc1 + 
                     snow_winter1 +
                     snow_winter2 +
                     r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     tsummer1.mean +
                     tsummer2.mean +
                     tautumn.mean)

plot(varclus(vMx3, data=male_db))
abline(h=0.5,col="red")

vFx3 <- as.formula(horn ~
                     
                     Jday +
                     substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     ndvi.m1s1.pc1 + 
                     snow_winter1 +
                     snow_winter2 +
                     r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     tsummer1.mean +
                     tsummer2.mean +
                     tautumn.mean)

plot(varclus(vFx3, data=female_db))
abline(h=0.5,col="red")

```

same as with previous PCA
t_summer1.mean und snow winter2 correlated in male and female
r_newsummer1 and tautum.mean correlated in male and female

The same procedure as above. Running 4 models for male and 4 models for female ommitting different combinations of collinear climate variables.

```{r,eval=FALSE}
M_x3.1 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1s1.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=male_db, REML=F)

AIC(M_x3.1)#  11926.46

F_x3.1 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1s1.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=female_db, REML=F)



AIC(F_x3.1)# 9924.476

#model omitting snow winter and tautumn.mean

M_x3.2 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1s1.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=male_db, REML=F)

AIC(M_x3.2)# 11926.46

F_x3.2 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1s1.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=female_db, REML=F)



AIC(F_x3.2)#9922.43 

#omitting  tsummer1.mean and r_newsummer1

M_x3.3 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density, k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1s1.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=male_db, REML=F)

AIC(M_x3.3)#11928.63

F_x3.3 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1s1.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=female_db, REML=F)



AIC(F_x3.3)# 9921.486

#############
#omitting  tsummer1.mean and tautumn.mean

M_x3.4 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1s1.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=male_db, REML=F)

AIC(M_x3.4)# 11928.61

F_x3.4 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m1s1.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=female_db, REML=F)



AIC(F_x3.4)#9921.486
 
```

#### NDVI PCA May and summer of the second year


Collinearity check

```{r}
vMx4 <- as.formula(horn ~
                     
                     Jday +
                     substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     ndvi.m2s2.pc1 + 
                     snow_winter1 +
                     snow_winter2 +
                     r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     tsummer1.mean +
                     tsummer2.mean +
                     tautumn.mean)

plot(varclus(vMx4, data=male_db))
abline(h=0.5,col="red")

vFx4 <- as.formula(horn ~
                     
                     Jday +
                     substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     ndvi.m2s2.pc1 + 
                     snow_winter1 +
                     snow_winter2 +
                     r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     tsummer1.mean +
                     tsummer2.mean +
                     tautumn.mean)

plot(varclus(vFx4, data=female_db))
abline(h=0.5,col="red")


```

Same result as as above: 
 - t_summer1.mean und snow winter2 correlated in male and female
 - r_newsummer1 and tautum.mean correlated in male and female
 
Again running 4 models for male and 4 models for female ommitting different combinations of collinear climate variables.

```{r,eval=FALSE}
M_x4.1 <-  gam(horn ~
                 s(Jday,bs="ts")+
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m2s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=male_db, REML=F)

AIC(M_x4.1)#  11924.08

F_x4.1 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m2s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=female_db, REML=F)



AIC(F_x4.1)#9924.199

#model omitting snow winter and tautumn.mean

M_x4.2 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m2s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=male_db, REML=F)

AIC(M_x4.2)# 11924.08

F_x4.2 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=2, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m2s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 #s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=female_db, REML=F)



AIC(F_x4.2)#9923.389

#omitting  tsummer1.mean and r_newsummer1

M_x4.3 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m2s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=male_db, REML=F)

AIC(M_x4.3)#11927.15 

F_x4.3 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m2s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts") +
                 s(tautumn.mean, k=3, bs="ts"),
               data=female_db, REML=F)



AIC(F_x4.3)# 9926.057

#############
#omitting  tsummer1.mean and tautumn.mean

M_x4.4 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m2s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=male_db, REML=F)

AIC(M_x4.4)# 11924.93

F_x4.4 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(ndvi.m2s2.pc1,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
               #s(tautumn.mean, k=3, bs="ts")
               ,data=female_db, REML=F)

AIC(F_x4.4)#  9924.151
```
A look at the summary for significance
```{r}
summary(F_x4.4)
```
### Elevation

Model including elevation instead of NDVI PCA

Collinearity check:
```{r}
vMq <- as.formula(horn ~
                     
                     Jday +
                     f.substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     q_media + 
                     snow_winter1 +
                     snow_winter2 +
                     #r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     #tsummer1.mean +
                     tsummer2.mean 
                     #tautumn.mean
                  )

plot(varclus(vMq, data=male_db))
abline(h=0.5,col="red")

vFq <- as.formula(horn ~
                    
                    Jday +
                    f.substrate +
                    year +
                    council_cod +
                    weight +
                    density +
                    log.ndvi.slop1 +
                    log.ndvi.slop2 +
                    ndvi.maxincr1 +
                    ndvi.maxincr2 +
                    q_media + 
                    snow_winter1 +
                    snow_winter2 +
                    #r_newsummer1 +
                    r_newsummer2 +
                    twinter.mean1 +
                    twinter.mean2 +
                    tspring1.mean +
                    tspring2.mean +
                    #tsummer1.mean +
                    tsummer2.mean 
                    #tautumn.mean
                    )

plot(varclus(vFq, data=female_db))
abline(h=0.5,col="red")
```

Three variables had been ommitted because of collinearity. Models for male and for female:

```{r,eval=FALSE}
Mq1 <-  gam(horn ~
                 s(Jday,bs="ts") +
                 f.substrate +
                 s(f.year, bs="re") +
                 s(f.council_cod, bs="re") +
                 s(weight, bs="ts") +
                 s(density,k=3, bs="ts") +
                 s(log.ndvi.slop1, bs="ts") +
                 s(log.ndvi.slop2, bs="ts") +
                 s(ndvi.maxincr1, bs="ts") +
                 s(ndvi.maxincr2,k=4, bs="ts") +
                 s(q_media,k=4, bs="ts") +
                 s(snow_winter1, k=3, bs="ts") +
                 s(snow_winter2, k=3, bs="ts") +
                 #s(r_newsummer1, k=3, bs="ts") +
                 s(r_newsummer2, k=3, bs="ts") +
                 s(twinter.mean1, k=3, bs="ts") +
                 s(twinter.mean2, k=3, bs="ts") +
                 s(tspring1.mean, k=3, bs="ts") +
                 s(tspring2.mean, k=3, bs="ts") +
                 #s(tsummer1.mean, k=3, bs="ts") +
                 s(tsummer2.mean, k=3, bs="ts")
                 #s(tautumn.mean, k=3, bs="ts")
               ,data=male_db, REML=F)





AIC(Mq1)#11928.13


Fq1 <-  gam(horn ~
              s(Jday,bs="ts") +
              f.substrate +
              s(f.year, bs="re") +
              s(f.council_cod, bs="re") +
              s(weight, bs="ts") +
              s(density,k=3, bs="ts") +
              s(log.ndvi.slop1, bs="ts") +
              s(log.ndvi.slop2, bs="ts") +
              s(ndvi.maxincr1, bs="ts") +
              s(ndvi.maxincr2,k=4, bs="ts") +
              s(q_media,k=4, bs="ts") +
              s(snow_winter1, k=3, bs="ts") +
              s(snow_winter2, k=3, bs="ts") +
              #s(r_newsummer1, k=3, bs="ts") +
              s(r_newsummer2, k=3, bs="ts") +
              s(twinter.mean1, k=3, bs="ts") +
              s(twinter.mean2, k=3, bs="ts") +
              s(tspring1.mean, k=3, bs="ts") +
              s(tspring2.mean, k=3, bs="ts") +
              #s(tsummer1.mean, k=3, bs="ts") +
              s(tsummer2.mean, k=3, bs="ts")
              #s(tautumn.mean, k=3, bs="ts")
            ,data=female_db, REML=F)

#q_media k=4 applied 
AIC(Fq1)# 9922.87
summary(Fq1)
```

For q_media bs="ts" would be sufficient in the male model but in both sexes  k=4 was set because of necessarity in the female model

```{r}
par(mfrow=c(1,1))
plot(Fq1,select = 10)

```

### Open area

Variable percentage of open area replaces the variable elevation in the model.

Check for collinearity:

```{r}
vMaa <- as.formula(horn ~
                    
                    Jday +
                    f.substrate +
                    year +
                    council_cod +
                    weight +
                    density +
                    log.ndvi.slop1 +
                    log.ndvi.slop2 +
                    ndvi.maxincr1 +
                    ndvi.maxincr2 +
                    Perc.area.aperta + 
                    snow_winter1 +
                    snow_winter2 +
                    #r_newsummer1 +
                    r_newsummer2 +
                    twinter.mean1 +
                    twinter.mean2 +
                    tspring1.mean +
                    tspring2.mean +
                    #tsummer1.mean +
                    tsummer2.mean 
                   #tautumn.mean
)

plot(varclus(vMaa, data=male_db))
abline(h=0.5,col="red")

vFaa <- as.formula(horn ~
                     
                     Jday +
                     f.substrate +
                     year +
                     council_cod +
                     weight +
                     density +
                     log.ndvi.slop1 +
                     log.ndvi.slop2 +
                     ndvi.maxincr1 +
                     ndvi.maxincr2 +
                     Perc.area.aperta + 
                     snow_winter1 +
                     snow_winter2 +
                     #r_newsummer1 +
                     r_newsummer2 +
                     twinter.mean1 +
                     twinter.mean2 +
                     tspring1.mean +
                     tspring2.mean +
                     #tsummer1.mean +
                     tsummer2.mean 
                   #tautumn.mean
)

plot(varclus(vFaa, data=female_db))
abline(h=0.5,col="red")


```
All good

Male and female models:

```{r,eval=FALSE}
Maa1 <-  gam(horn ~
              s(Jday,bs="ts") +
              f.substrate +
              s(f.year, bs="re") +
              s(f.council_cod, bs="re") +
              s(weight, bs="ts") +
              s(density, k=3, bs="ts") +
              s(log.ndvi.slop1, bs="ts") +
              s(log.ndvi.slop2, bs="ts") +
              s(ndvi.maxincr1, bs="ts") +
              s(ndvi.maxincr2,k=4, bs="ts") +
              s(Perc.area.aperta,k=3, bs="ts") +
              s(snow_winter1, k=3, bs="ts") +
              s(snow_winter2, k=3, bs="ts") +
              #s(r_newsummer1, k=3, bs="ts") +
              s(r_newsummer2, k=3, bs="ts") +
              s(twinter.mean1, k=3, bs="ts") +
              s(twinter.mean2, k=3, bs="ts") +
              s(tspring1.mean, k=3, bs="ts") +
              s(tspring2.mean, k=3, bs="ts") +
              #s(tsummer1.mean, k=3, bs="ts") +
              s(tsummer2.mean, k=3, bs="ts")
            #s(tautumn.mean, k=3, bs="ts")
            ,data=male_db, REML=F)

AIC(Maa1)#11927.25
summary(Maa1)


```

```{r}
plot(Maa1,select = 10)
```

Perc_area_aperta k=3 is ok

```{r}
summary(Maa1)
```

Percentage of open area (Perc_area_aperta) is significant


```{r,eval=FALSE}
Faa1 <-  gam(horn ~
              s(Jday,bs="ts") +
              f.substrate +
              s(f.year, bs="re") +
              s(f.council_cod, bs="re") +
              s(weight, bs="ts") +
              s(density,k=3, bs="ts") +
              s(log.ndvi.slop1, bs="ts") +
              s(log.ndvi.slop2, bs="ts") +
              s(ndvi.maxincr1, bs="ts") +
              s(ndvi.maxincr2, bs="ts") +
              s(Perc.area.aperta,k=3, bs="ts") +
              s(snow_winter1, k=3, bs="ts") +
              s(snow_winter2, k=3, bs="ts") +
              #s(r_newsummer1, k=3, bs="ts") +
              s(r_newsummer2, k=3, bs="ts") +
              s(twinter.mean1, k=3, bs="ts") +
              s(twinter.mean2, k=3, bs="ts") +
              s(tspring1.mean, k=3, bs="ts") +
              s(tspring2.mean, k=3, bs="ts") +
              #s(tsummer1.mean, k=3, bs="ts") +
              s(tsummer2.mean, k=3, bs="ts")
              #s(tautumn.mean, k=3, bs="ts")
            ,data=female_db, REML=F)

```
k was reduced in M/Faa1 to k=3 because of a better modelling in the model for female (Faa1)
```{r}
plot(Faa1,select = 10)
gam.check(Faa1)
```

```{r}
shapiro.test(resid(Faa1))
```
ok


### Model comparison



```{r,message=FALSE,warnings=FALSE}
library(knitr)
```

Table of AIC´s:

 - m1m2 = models with NDVI May of first and second year
 - s1s2 = models with NDVI summer of first and second year
 - m1s1 = models with NDVI May and summer of the first year
 - m2s2 = models with NDVI May and summer of the second year
 
```{r}

load("aic_tab.RData")
kable(aic_tab)
```

Summary of the AICs of models of male chamois hornlength

```{r}

summary (aic_tab$AIC_male)
```

Summary of AICs of the models of female chamois hornlength

```{r}
summary (aic_tab$AIC_female)
```

Conclusion:
Different variables which had been identified as relevant for the horn length by the randomForest analysis had been tested in separate male and female models.The AIC values of the different models are very similar within each sex.
The resulting AIC´s did not underpin a hypothesis of differences in the effect of the investigated environmental variables regarding male or female chamois hornlength.